{
  // =============================================================================
  // Linux Voice Assistant (LVA) — Configuration Example
  //
  // Notes:
  // - This file uses JSON-with-comments (jsonc). Your editor may support it.
  // - The app loads config via linux_voice_assistant.config.load_config_from_json().
  // - Some behavior can be overridden by CLI flags (e.g., --debug).
  // =============================================================================

  // ---------------------------------------------------------------------------
  // Required
  // ---------------------------------------------------------------------------
  "app": {
    // Required: Friendly name for this LVA instance
    "name": "My Linux Voice Assistant",

    // Optional: Wake word triggered sound (relative to repo root)
    "wakeup_sound": "sounds/wake_word_triggered.flac",

    // Optional: Timer finished sound (relative to repo root)
    "timer_finished_sound": "sounds/timer_finished.flac",

    // Optional: Preferences file used to persist state like volume/num_leds
    // (relative to repo root)
    "preferences_file": "preferences.json",

    // Optional: Enables debug logging by default
    // Note: can also be enabled via CLI flag --debug
    "debug": false
  },

  // ---------------------------------------------------------------------------
  // Optional: Audio I/O + Output Volume Sync
  // ---------------------------------------------------------------------------
  "audio": {
    // Optional:
    // - null/omit => default microphone
    // - string name => exact device name (soundcard backend)
    // - string number => index into soundcard device list (e.g. "0", "1", ...)
    "input_device": "reSpeaker XVF3800 4-Mic Array Analog Stereo",

    // Optional: audio capture block size
    "input_block_size": 1024,

    // Optional:
    // - null/omit => mpv chooses default output
    // - string => mpv audio-device (e.g. "pulse/alsa_output....")
    "output_device": "alsa_output.usb-Seeed_Studio_reSpeaker_XVF3800_4-Mic_Array_114993701254500095-00.analog-stereo: reSpeaker XVF3800 4-Mic Array Analog Stereo",

    // Optional: Sync the host OS output volume at startup to match the volume
    // stored in preferences.json (LVA MediaPlayer volume).
    //
    // When enabled, LVA will attempt (in order): wpctl -> pactl -> amixer.
    //
    // Default: false
    "volume_sync": false,

    // Optional: Maximum output volume percent for the underlying sink.
    //
    // Default: 100
    "max_volume_percent": 100
  },

  // ---------------------------------------------------------------------------
  // Optional: Wake word config
  // ---------------------------------------------------------------------------
  "wake_word": {
    // Optional: If omitted/empty, code falls back to defaults:
    // ["wakewords", "wakewords/openWakeWord"]
    //
    // Paths are relative to repo root.
    "directories": [],

    // Optional: default wake word model id
    "model": "okay_nabu",

    // Optional: stop model id (micro wake word)
    "stop_model": "stop",

    // Optional: debounce/refractory window after wake word triggers
    "refractory_seconds": 2.0,

    // Optional: directory for downloaded models (relative to repo root)
    "download_dir": "local",

    // Optional: OpenWakeWord activation threshold.
    //
    // OpenWakeWord triggers if its model probability exceeds this value.
    // Range: 0.0 - 1.0
    //
    // Default: 0.5 (matches previous hardcoded behavior)
    "openwakeword_threshold": 0.5
  },

  // ---------------------------------------------------------------------------
  // Optional: ESPHome protocol server settings (the LVA exposes an ESPHome API)
  // ---------------------------------------------------------------------------
  "esphome": {
    // Default: "0.0.0.0" (listen on all interfaces)
    "host": "0.0.0.0",

    // Default: 6053
    "port": 6053
  },

  // ---------------------------------------------------------------------------
  // Optional: LEDs
  // ---------------------------------------------------------------------------
  "led": {
    // Optional: if false, LED controller runs in no-op mode
    "enabled": true,

    // "dotstar" | "neopixel" | "xvf3800"
    "led_type": "dotstar",

    // "spi" | "gpio" | "usb"
    // - dotstar: "spi" or "gpio"
    // - neopixel: "spi" or "gpio"
    // - xvf3800: "usb"
    "interface": "spi",

    // GPIO pins — used when interface="gpio"
    // For DotStar GPIO: both clock_pin + data_pin are used
    // For NeoPixel GPIO: only data_pin is used (clock_pin ignored)
    // For XVF3800: unused and ignored
    "clock_pin": 13,
    "data_pin": 12,

    // Default number of LEDs (may be overridden by preferences.json after first run)
    "num_leds": 3
  },

  // ---------------------------------------------------------------------------
  // Optional: MQTT
  //
  // IMPORTANT for Tray Client:
  // - The tray client requires MQTT enabled AND mqtt.host set.
  // - If mqtt.host is null/empty, tray client will refuse to start.
  // ---------------------------------------------------------------------------
  "mqtt": {
    // If set, mqtt.enabled becomes true automatically
    "host": null,

    "port": 1883,
    "username": null,
    "password": null
  },

  // ---------------------------------------------------------------------------
  // Optional: Button controller
  // ---------------------------------------------------------------------------
  "button": {
    // Master enable
    "enabled": false,

    // "gpio" | "xvf3800"
    // - gpio: short/long press logic (pin + long_press_seconds)
    // - xvf3800: uses the XVF3800 built-in mute button as a mute toggle
    "mode": "gpio",

    // gpio mode only
    "pin": 17,
    "long_press_seconds": 1.0,

    // Polling interval (used by both gpio + xvf3800 button controllers)
    "poll_interval_seconds": 0.01
  },

  // ---------------------------------------------------------------------------
  // Optional: Desktop Tray Client
  // ---------------------------------------------------------------------------
  "tray": {
    // The systemd --user unit name the tray client controls (start/stop/restart).
    //
    // The tray client default (if omitted): "linux-voice-assistant.service"
    //
    // If you renamed the LVA unit, set it here so the tray menu controls
    // the correct service.
    "systemd_service_name": "linux-voice-assistant.service"
  },
  
  // ---------------------------------------------------------------------------
  // Sendspin client configuration (LVA -> Music Assistant)
  //
  // Notes:
  // - This file is JSON-with-comments (JSONC). If your JSON loader does NOT
  //   support comments, remove lines starting with //.
  // - All times are seconds unless the key name ends with _ms.
  // ---------------------------------------------------------------------------

  "sendspin": {
    // Enable/disable the Sendspin client feature.
    "enabled": true,

    // -----------------------------------------------------------------------
    // Client identity / capabilities
    // -----------------------------------------------------------------------
    "client": {
      // Name shown in Music Assistant / Sendspin UI.
      "name": "LVA Sendspin Client",

      // Optional extra info that MA may display (safe to omit).
      "device_info": {
        "manufacturer": "OHF-Voice",
        "model": "Linux Voice Assistant",
        "sw_version": "dev"
      }
    },

    // Which Sendspin roles this client will advertise. Most installs can leave
    // these defaults as-is.
    "roles": {
      "player": true,
      "metadata": true,
      "controller": true
    },

    // -----------------------------------------------------------------------
    // Startup state (seeded from preferences.json by LVA __main__.py)
    // If you don't have preferences.json yet, these values provide defaults.
    // -----------------------------------------------------------------------
    "initial": {
      // User volume (0–100). This is the *saved* volume shown in MA.
      "volume": 50,

      // Whether the client starts muted.
      "muted": false
    },

    // -----------------------------------------------------------------------
    // Connection / discovery / keepalive / clock sync
    // -----------------------------------------------------------------------
    "connection": {
      // If true, use mDNS discovery to find the MA Sendspin server.
      // If you set server_host, discovery is bypassed.
      "mdns": true,

      // Optional static connection (recommended if you want to avoid discovery):
      // "server_host": "192.168.0.100",
      // "server_port": 8927,
      // "server_path": "/sendspin",

      // Time to wait for server/hello after connecting.
      "hello_timeout_seconds": 8.0,

      // WebSocket protocol keepalive pings.
      // IMPORTANT: Some MA/Sendspin servers mis-handle protocol pings while idle
      // (e.g., after stream/end on FLAC). Set either value to 0 to disable pings.
      "ping_interval_seconds": 0,
      "ping_timeout_seconds": 0,

      // How often the client sends client/time for clock sync.
      // 1.0s gives faster convergence; 3–5s reduces network chatter.
      "time_sync_interval_seconds": 1.0
    },

    // -----------------------------------------------------------------------
    // Player / audio pipeline configuration
    // -----------------------------------------------------------------------
    "player": {
      // Preferred codec. The client will advertise a minimal set of codecs so
      // MA is more likely to select your preference.
      // Valid: "pcm" | "flac" | "opus"
      "preferred_codec": "pcm",

      // Which codecs this client *can* accept. Keep "pcm" in the list.
      // If you include "flac" or "opus", MA may still choose them depending on
      // server policy (the client will try to honor preferred_codec).
      "supported_codecs": ["pcm", "flac", "opus"],

      // Audio format we request/expect for PCM output
      "sample_rate": 48000,
      "channels": 2,
      "bit_depth": 16,

      // Optional: path to ffmpeg (used for FLAC decode and Opus fallback).
      "ffmpeg_path": "ffmpeg",

      // ---------------------------------------------------------------------
      // Sync / buffering knobs (Stages A+B)
      // ---------------------------------------------------------------------

      // Target playout latency (ms) for the timestamp-aware jitter buffer.
      // Higher = more resilient to Wi-Fi jitter, but more delay.
      // Typical: 150–300ms for LAN, 300–500ms for noisier networks.
      "sync_target_latency_ms": 250,

      // Late frame drop threshold (ms).
      // If a packet arrives "too late" (its timestamp is already in the past by
      // more than this window), we drop it rather than playing it late.
      // Typical: 60–150ms.
      "sync_late_drop_ms": 100,

      // Per-device latency compensation (ms).
      // Use this to align devices that have *fixed* extra delay (DSP, amp, etc.).
      // - If THIS LVA client plays EARLIER than others, INCREASE this value.
      // - If THIS LVA client plays LATER than others, DECREASE it (cannot be < 0;
      //   instead, add delay to the other devices).
      "output_latency_ms": 0,

      // Ducking amount while voice is active (if coordination.duck_during_voice is true).
      "duck_volume_percent": 20,

      // Advertised buffer capacity to MA (bytes). This does not directly change
      // mpv's internal queue, but helps MA size bursts.
      "buffer_capacity_bytes": 1048576,

      // Player-side commands the client will accept from MA.
      "supported_commands": ["volume", "mute"]
    },

    // -----------------------------------------------------------------------
    // Coordination with voice assistant states (ducking)
    // -----------------------------------------------------------------------
    "coordination": {
      // If true, reduce (duck) Sendspin playback while LVA is speaking/listening.
      "duck_during_voice": true
    },

    // -----------------------------------------------------------------------
    // Debug logging toggles
    // -----------------------------------------------------------------------
    "logging": {
      // Log message types (rx/tx).
      "debug_protocol": false,

      // Log full JSON payloads (verbose).
      "debug_payloads": false
    }
  }
}
